var minilogin={isOpen:false,isLoaded:false,setClosedEvents:function(){$('.minilogin').off('mouseleave.menucart').on('mouseenter.menucart',showMiniLogin);},setOpenEvents:function(){$('.minilogin').off('mouseenter.menucart').on('mouseleave.menucart',hideMiniLogin);}};var minicart={isOpen:false,isLoaded:false,setClosedEvents:function(){$('.minicesta').off('mouseleave.menucart').on('mouseenter.menucart',function(e){loadMiniCart();});},setOpenEvents:function(){$('.minicesta').off('mouseenter.menucart').on('mouseleave.menucart',function(e){hideMiniCart();});}};function addCarrito_345($_name,$_id_art,$_price,$_qty,$_brand,$_category){dataLayer.push({'event':'addToCart','ecommerce':{'currencyCode':'EUR','add':{'products':[{'name':$_name,'id':$_id_art,'price':$_price,'brand':$_brand,'category':$_category,'variant':'','quantity':$_qty}]}}});}
function quitarCarrito_455($_id,$_qty){dataLayer.push({'event':'removeFromCart','ecommerce':{'remove':{'products':[{'name':'','id':$_id,'price':'','brand':'','category':'','variant':'','quantity':$_qty}]}}});}
function hideMiniLogin(){if(minilogin.isOpen){$('.minilogin').off('mouseleave.menucart');$('#minilogincontent').fadeOut(200,function(){minilogin.setClosedEvents();minilogin.isOpen=false;});}}
function showMiniLogin(e){if(!minilogin.isOpen&&minilogin.isLoaded){hideMiniCart();$('.minilogin').off('mouseenter.menucart');minilogin.isOpen=true;$('#minilogincontent').fadeIn(200,function(){minilogin.setOpenEvents();});}}
function hideMiniCart(){if(minicart.isOpen){$('.minicesta').off('mouseleave.menucart');$('#minicart').fadeOut(200,function(){$('.minicesta').on('mouseenter.menucart',function(e){loadMiniCart();});minicart.isOpen=false;minicart.isLoaded=($('#numberOfItems').val()==0);});}}
function loadMiniCart(show){if(!minicart.isOpen&&!minicart.isLoaded){minicart.isOpen=typeof show!=='undefined'?show:true;$('.minicesta').off('mouseenter.menucart').find("a").css("cursor","wait");$.post('//www.pccomponentes.com/core/cart/loadMiniCart').done(function(data){$('#minicartcontent').html(data);$('#art-cesta-number').html($('#numberOfItems').val());}).always(function(data){minicart.isLoaded=true;$('.minicesta a').css("cursor","inherit");if($('#numberOfItems').val()==0){minicart.setClosedEvents();}else{if(minicart.isOpen===true){$('#minicart').stop().hide();hideMiniLogin();$('#minicart').fadeIn(200,function(){$('.minicesta').on('mouseleave.menucart',function(e){hideMiniCart();});});}else{minicart.setOpenEvents();}}}).fail(hideMiniCart);}}
$(document).ready(function(){$('#minicart').hide();$('#minilogincontent').hide();$.post('//www.pccomponentes.com/core/oe/loadPrices',function(data){var prices=data.split(".");$('.loadPricesOE').html(prices[0]+"<em>."+prices[1]+"&euro;</em>");if(data=="??.??"){$('.textoRegistroOE').show();}else{$('.textoRegistroOE').hide();}});$.post('//www.pccomponentes.com/core/client/isLogged',function(data){$('#userNameMiniLogin').html(data);});$.post('//www.pccomponentes.com/core/cart/loadMiniCart').done(function(data){$('#minicartcontent').html(data);var nitems=$('#numberOfItems').val();$('#art-cesta-number').html(nitems);if(nitems!=0){$('#art-cesta-number').addClass('art-cesta-rellena');}});if($('.minilogin').data('l')=='1'){$.post('//www.pccomponentes.com/core/client/minilogin').done(function(data){if(data.length>0){$('#minilogincontent').html(data);minilogin.isLoaded=true;$('.minilogin').on('mouseenter.menucart',showMiniLogin);}});}
$('.minicesta').on('mouseenter.menucart',function(e){loadMiniCart();}).on('click.menucart','.addone',function(){$('.addone').off('click.menucart');$('.removeone').off('click.menucart');var id=$(this).attr('data-id-order');var qty=parseInt($('#minicartqty'+ id).attr('data-qty'),10)+ 1;$('#minicartqty'+ id).html(qty);$.post('//www.pccomponentes.com/core/cart/update/id/'+ id+'/qty/'+ qty).done(function(data){loadMiniCart();$.post('//www.pccomponentes.com/core/product/getDataJson/id/'+ data).done(function(data){var array=jQuery.parseJSON(data);addCarrito_345(array['nombre'],array['id_articulo'],array['precio'],1,array['marca'],array['familia']);});});$('#art-cesta-number').text(parseInt($('#art-cesta-number').text(),10)+ 1);}).on('click.menucart','.removeone',function(){$('.addone').off('click.menucart');$('.removeone').off('click.menucart');var id=$(this).attr('data-id-order');var qty=parseInt($('#minicartqty'+ id).attr('data-qty'),10)- 1;if(qty<=0){$.post('//www.pccomponentes.com/core/cart/removeItem/stop/stop/id/'+ id).done(function(data){loadMiniCart();quitarCarrito_455(data,1);});}else{$('#minicartqty'+ id).attr('data-qty',qty);$('#minicartqty'+ id).html(qty);$.post('//www.pccomponentes.com/core/cart/update/id/'+ id+'/qty/'+ qty).done(function(data){loadMiniCart();quitarCarrito_455(data,1);});}
$('#art-cesta-number').text(parseInt($('#art-cesta-number').text(),10)-1);}).on('click.menucart','.deleteItem',function(){var id=$(this).val();$.post('//www.pccomponentes.com/core/cart/removeItem/stop/stop/id/'+ id).done(function(data){loadMiniCart();quitarCarrito_455(data,$('#minicartqty'+ id).attr("data-qty"));});});$('.minilogin').on('click.menucart','#forgot',function(){if(/.+@.+\.\w+/.test($('#loginEmail').val())){bootbox.alert('Para recuperar la contrase&ntilde;a debes escribir el correo electr&oacute;nico');}else{$.post('//www.pccomponentes.com/core/client/forgot/email/'+ $('#loginEmail').val()).done(function(data){if(data==404){bootbox.alert('El correo electr&oacute;nico '+ $('#loginEmail').val()+' no existe en nuestra base de datos. Si tiene cualquier problema, por favor, contacte con nuestro servicio de atenci&oacute;n al cliente');}else if(data==200){bootbox.alert('Acabamos de enviar un correo electr&oacute;nico a la direcci&oacute;n '+ $('#loginEmail').val()+' para continuar con el proceso.');}});}});});